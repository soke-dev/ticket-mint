"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[33699],{33699:function(e,t,i){i.r(t),i.d(t,{InAppWebConnector:function(){return E}});var a=i(18525),r=i(8974),n=i(46711),s=i(4145);function o(e){return new Promise(t=>{setTimeout(t,1e3*e)})}let l={height:"100%",width:"100%",border:"none",backgroundColor:"transparent",colorScheme:"light",position:"fixed",top:"0px",right:"0px",zIndex:"2147483646",display:"none"},c=new Map;class u{async onIframeLoadedInitVariables(){return{}}onIframeLoadHandler(e,t){return async()=>{var i;let a=new MessageChannel,r=new Promise((i,r)=>{a.port1.onmessage=n=>{let{data:s}=n;a.port1.close(),s.success||r(Error(s.error)),c.set(e.src,!0),t&&t(),i(!0)}});null==e||null===(i=e.contentWindow)||void 0===i||i.postMessage({eventType:"initIframe",data:await this.onIframeLoadedInitVariables()},this.iframeBaseUrl,[a.port2]),await r}}async call(e){var t;let{procedureName:i,params:a,showIframe:r=!1}=e;for(;!c.get(this.iframe.src);)await o(this.POLLING_INTERVAL_SECONDS);r&&(this.iframe.style.display="block",await o(.005));let n=new MessageChannel,s=new Promise((e,t)=>{n.port1.onmessage=async i=>{let{data:a}=i;n.port1.close(),r&&(await o(.1),this.iframe.style.display="none"),a.success?e(a.data):t(Error(a.error))}});return null===(t=this.iframe.contentWindow)||void 0===t||t.postMessage({eventType:i,data:a},this.iframeBaseUrl,[n.port2]),s}destroy(){c.delete(this.iframe.src)}constructor({link:e,baseUrl:t,iframeId:i,container:a=document.body,onIframeInitialize:r}){Object.defineProperty(this,"iframe",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"POLLING_INTERVAL_SECONDS",{enumerable:!0,configurable:!0,writable:!0,value:1.4}),Object.defineProperty(this,"iframeBaseUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.iframeBaseUrl=t;let n=document.getElementById(i),s=new URL(e);if(!n||n.src!==s.href){n=document.createElement("iframe");let e={...l};Object.assign(n.style,e),n.setAttribute("id",i),n.setAttribute("fetchpriority","high"),a.appendChild(n),n.src=s.href;let t=e=>{if("ewsIframeLoaded"===e.data.eventType){if(window.removeEventListener("message",t),!n){console.warn("thirdweb iFrame not found");return}this.onIframeLoadHandler(n,r)()}};window.addEventListener("message",t)}this.iframe=n}}class d extends u{async onIframeLoadedInitVariables(){var e,t,i;let a=new s.m({clientId:this.clientId,ecosystemId:null===(e=this.ecosystem)||void 0===e?void 0:e.id});return{authCookie:await a.getAuthCookie(),deviceShareStored:await a.getDeviceShare(),walletUserId:await a.getWalletUserId(),clientId:this.clientId,partnerId:null===(t=this.ecosystem)||void 0===t?void 0:t.partnerId,ecosystemId:null===(i=this.ecosystem)||void 0===i?void 0:i.id}}constructor({clientId:e,baseUrl:t,ecosystem:i}){super({iframeId:h+((null==i?void 0:i.id)||""),link:function(e){let{clientId:t,baseUrl:i,path:a,ecosystem:r,queryParams:n}=e,s=new URL("".concat(a),i);if(n)for(let e of Object.keys(n)){var o;s.searchParams.set(e,(null===(o=n[e])||void 0===o?void 0:o.toString())||"")}return s.searchParams.set("clientId",t),(null==r?void 0:r.partnerId)!==void 0&&s.searchParams.set("partnerId",r.partnerId),(null==r?void 0:r.id)!==void 0&&s.searchParams.set("ecosystemId",r.id),s}({clientId:e,path:n.hD,ecosystem:i,baseUrl:t}).href,baseUrl:t,container:document.body}),Object.defineProperty(this,"clientId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.clientId=e,this.ecosystem=i}}let h="thirdweb-in-app-wallet-iframe";class p{async sendEmailLoginOtp(e){let{email:t}=e;return await this.preLogin(),await this.LoginQuerier.call({procedureName:"sendThirdwebEmailLoginOtp",params:{email:t}})}async sendSmsLoginOtp(e){let{phoneNumber:t}=e;return await this.preLogin(),await this.LoginQuerier.call({procedureName:"sendThirdwebSmsLoginOtp",params:{phoneNumber:t}})}constructor({baseUrl:e,querier:t,preLogin:i,postLogin:a,client:r,ecosystem:n}){Object.defineProperty(this,"LoginQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"preLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"postLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"baseUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.baseUrl=e,this.LoginQuerier=t,this.preLogin=i,this.postLogin=a,this.client=r,this.ecosystem=n}}class g extends p{async getOauthLoginUrl(e){try{return await this.LoginQuerier.call({procedureName:"getHeadlessOauthLoginLink",params:{authProvider:e}})}catch(e){throw console.error(e),e}}async loginWithModal(){await this.preLogin();let e=await this.LoginQuerier.call({procedureName:"loginWithThirdwebModal",params:void 0,showIframe:!0});return this.postLogin(e)}async loginWithEmailOtp(e){let{email:t}=e;await this.preLogin();let i=await this.LoginQuerier.call({procedureName:"loginWithThirdwebModal",params:{email:t},showIframe:!0});return this.postLogin(i)}getOauthPopUpSizing(e){return e===r.Ho.FACEBOOK?"width=715, height=555":"width=350, height=500"}async loginWithOauth(e){let t=null==e?void 0:e.openedWindow,i=!1;if(t||(t=window.open("","Login",this.getOauthPopUpSizing(e.oauthProvider)),i=!0),!t)throw Error("Something went wrong opening pop-up");let[{loginLink:a}]=await Promise.all([this.getOauthLoginUrl(e.oauthProvider),this.preLogin()]);t.location.href=a;let r=await new Promise((a,r)=>{let n=window.setInterval(async()=>{t&&t.closed&&(clearInterval(n),window.removeEventListener("message",s),r(Error("User closed login window")))},1e3),s=async o=>{if(o.origin===this.baseUrl){if("object"!=typeof o.data){r(Error("Invalid event data"));return}switch(o.data.eventType){case"userLoginSuccess":window.removeEventListener("message",s),clearInterval(n),this.closeWindow({isWindowOpenedByFn:i,win:t,closeOpenedWindow:null==e?void 0:e.closeOpenedWindow}),o.data.authResult&&a(o.data.authResult);break;case"userLoginFailed":window.removeEventListener("message",s),clearInterval(n),this.closeWindow({isWindowOpenedByFn:i,win:t,closeOpenedWindow:null==e?void 0:e.closeOpenedWindow}),r(Error(o.data.error));break;case"injectDeveloperClientId":var l,c;null==t||t.postMessage({eventType:"injectDeveloperClientIdResult",developerClientId:this.client.clientId,authOption:e.oauthProvider,partnerId:null===(l=this.ecosystem)||void 0===l?void 0:l.partnerId,ecosystemId:null===(c=this.ecosystem)||void 0===c?void 0:c.id},this.baseUrl)}}};window.addEventListener("message",s)});return this.postLogin({storedToken:{...r.storedToken,shouldStoreCookieString:!0},walletDetails:{...r.walletDetails,isIframeStorageEnabled:!1}})}async loginWithCustomJwt(e){let{encryptionKey:t,jwt:i}=e;await this.preLogin();let a=await this.LoginQuerier.call({procedureName:"loginWithCustomJwt",params:{encryptionKey:t,jwt:i}});return this.postLogin(a)}async loginWithCustomAuthEndpoint(e){let{encryptionKey:t,payload:i}=e;await this.preLogin();let a=await this.LoginQuerier.call({procedureName:"loginWithCustomAuthEndpoint",params:{encryptionKey:t,payload:i}});return this.postLogin(a)}async verifyEmailLoginOtp(e){let{email:t,otp:i,recoveryCode:a}=e,r=await this.LoginQuerier.call({procedureName:"verifyThirdwebEmailLoginOtp",params:{email:t,otp:i,recoveryCode:a}});return this.postLogin(r)}async verifySmsLoginOtp(e){let{phoneNumber:t,otp:i,recoveryCode:a}=e,r=await this.LoginQuerier.call({procedureName:"verifyThirdwebSmsLoginOtp",params:{phoneNumber:t,otp:i,recoveryCode:a}});return this.postLogin(r)}constructor(){super(...arguments),Object.defineProperty(this,"closeWindow",{enumerable:!0,configurable:!0,writable:!0,value:e=>{let{isWindowOpenedByFn:t,win:i,closeOpenedWindow:a}=e;t?null==i||i.close():i&&a?a(i):i&&i.close()}})}}class m{async preLogin(){await this.logout()}async postLogin(e){let{storedToken:t,walletDetails:i}=e;return t.shouldStoreCookieString&&await this.localStorage.saveAuthCookie(t.cookieString),await this.onAuthSuccess({storedToken:t,walletDetails:i})}async loginWithAuthToken(e,t){await this.preLogin();let i=await this.AuthQuerier.call({procedureName:"loginWithStoredTokenDetails",params:{storedToken:e.storedToken,recoveryCode:t}});return this.postLogin(i)}async loginWithModal(){return this.BaseLogin.loginWithModal()}async loginWithEmailOtp(e){return this.BaseLogin.loginWithEmailOtp(e)}async loginWithCustomJwt(e){return this.BaseLogin.loginWithCustomJwt(e)}async loginWithCustomAuthEndpoint(e){return this.BaseLogin.loginWithCustomAuthEndpoint(e)}async loginWithOauth(e){return this.BaseLogin.loginWithOauth(e)}async sendEmailLoginOtp(e){let{email:t}=e;return this.BaseLogin.sendEmailLoginOtp({email:t})}async sendSmsLoginOtp(e){let{phoneNumber:t}=e;return this.BaseLogin.sendSmsLoginOtp({phoneNumber:t})}async verifyEmailLoginOtp(e){return this.BaseLogin.verifyEmailLoginOtp(e)}async verifySmsLoginOtp(e){return this.BaseLogin.verifySmsLoginOtp(e)}async logout(){let{success:e}=await this.AuthQuerier.call({procedureName:"logout",params:void 0}),t=await this.localStorage.removeAuthCookie(),i=await this.localStorage.removeWalletUserId();return{success:e||t||i}}constructor({client:e,querier:t,onAuthSuccess:i,ecosystem:a,baseUrl:r}){Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"AuthQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onAuthSuccess",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"BaseLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=e,this.AuthQuerier=t,this.localStorage=new s.m({clientId:e.clientId,ecosystemId:null==a?void 0:a.id}),this.onAuthSuccess=i,this.BaseLogin=new g({postLogin:async e=>this.postLogin(e),preLogin:async()=>{await this.preLogin()},ecosystem:a,querier:t,client:e,baseUrl:r})}}var w=i(61350),y=i(85738);async function v(e,t){return await e({method:"eth_sendRawTransaction",params:[t]})}var b=i(90874),f=i(14520),L=i(24053);let I=async(e,t)=>{let i=await fetch("".concat((0,a.TS)("inAppWallet"),"/api/2024-05-05/ecosystem-wallet/").concat(e,"/partner/").concat(t),{headers:{"x-ecosystem-id":e,"x-ecosystem-partner-id":t||""}});return await i.json()};class O{async postWalletSetUp(e){let{deviceShareStored:t,walletAddress:i,isIframeStorageEnabled:a,walletUserId:r}=e;return a||await this.localStorage.saveDeviceShare(t,r),{walletAddress:i}}async getUserWalletStatus(){let e=await this.walletManagerQuerier.call({procedureName:"getUserStatus",params:void 0});return e.status===r.Nx.LOGGED_IN_WALLET_INITIALIZED?{status:r.Nx.LOGGED_IN_WALLET_INITIALIZED,...e.user,account:await this.getAccount()}:e.status===r.Nx.LOGGED_IN_NEW_DEVICE||e.status===r.Nx.LOGGED_IN_WALLET_UNINITIALIZED?{status:r.Nx.LOGGED_IN_WALLET_UNINITIALIZED,...e.user}:{status:e.status}}async getAccount(){var e,t;let i=this.walletManagerQuerier,a=this.client,r=null===(e=this.ecosystem)||void 0===e?void 0:e.partnerId,n=!!this.ecosystem,s=this.ecosystem?await I(this.ecosystem.id,null===(t=this.ecosystem)||void 0===t?void 0:t.partnerId):void 0,{address:o}=await i.call({procedureName:"getAddress",params:void 0}),l=async e=>{var t;let a={to:null!==(t=e.to)&&void 0!==t?t:void 0,data:e.data,value:e.value,gasLimit:e.gas,nonce:e.nonce,chainId:e.chainId};e.maxFeePerGas?(a.accessList=e.accessList,a.maxFeePerGas=e.maxFeePerGas,a.maxPriorityFeePerGas=e.maxPriorityFeePerGas,a.type=2):(a.gasPrice=e.gasPrice,a.type=0);let{signedTransaction:o}=await i.call({procedureName:"signTransaction",params:{transaction:a,chainId:e.chainId,partnerId:r,rpcEndpoint:"https://".concat(e.chainId,".rpc.thirdweb.com")},showIframe:(null==s||!s.permissions.includes("FULL_CONTROL_V1"))&&n});return o};return{address:o,async signTransaction(e){if(!e.chainId)throw Error("chainId required in tx to sign");return l({...e,chainId:e.chainId})},async sendTransaction(e){let t=(0,b.getRpcClient)({client:a,chain:(0,y.XY)(e.chainId)}),i=await l(e);return{transactionHash:await v(t,i)}},async signMessage(e){let{message:t}=e,a="string"==typeof t?t:t.raw instanceof Uint8Array?t.raw:(0,f.rR)(t.raw),{signedMessage:o}=await i.call({procedureName:"signMessage",params:{message:a,partnerId:r,chainId:1},showIframe:(null==s||!s.permissions.includes("FULL_CONTROL_V1"))&&n});return o},async signTypedData(e){var t;let a=(0,L.t)(e);(null===(t=a.types)||void 0===t?void 0:t.EIP712Domain)&&(a.types.EIP712Domain=void 0);let o=a.domain,l=(null==o?void 0:o.chainId)||1,{signedTypedData:c}=await i.call({procedureName:"signTypedDataV4",params:{domain:{chainId:l,verifyingContract:null==o?void 0:o.verifyingContract,name:null==o?void 0:o.name,version:null==o?void 0:o.version},types:a.types,message:a.message,chainId:l,partnerId:r,rpcEndpoint:"https://".concat(l,".rpc.thirdweb.com")},showIframe:(null==s||!s.permissions.includes("FULL_CONTROL_V1"))&&n});return c}}}constructor({client:e,ecosystem:t,querier:i}){Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ecosystem",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"walletManagerQuerier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.client=e,this.ecosystem=t,this.walletManagerQuerier=i,this.localStorage=new s.m({clientId:e.clientId,ecosystemId:null==t?void 0:t.id})}}class E{isClientIdLegacyPaper(e){return e.indexOf("-")>0&&36===e.length}async getUser(){return this.wallet.getUserWalletStatus()}getAccount(){return this.wallet.getAccount()}async preAuthenticate(e){let t=e.strategy;switch(t){case"email":return this.auth.sendEmailLoginOtp({email:e.email});case"phone":return this.auth.sendSmsLoginOtp({phoneNumber:e.phoneNumber});default:W(t,"Provider: ".concat(t," doesn't require pre-authentication"))}}async authenticate(e){let t=e.strategy;switch(t){case"email":return await this.auth.verifyEmailLoginOtp({email:e.email,otp:e.verificationCode});case"phone":return await this.auth.verifySmsLoginOtp({otp:e.verificationCode,phoneNumber:e.phoneNumber});case"apple":case"facebook":case"google":{let i=r.V5[t];return this.auth.loginWithOauth({oauthProvider:i,closeOpenedWindow:e.closeOpenedWindow,openedWindow:e.openedWindow})}case"jwt":return this.auth.loginWithCustomJwt({jwt:e.jwt,encryptionKey:e.encryptionKey});case"auth_endpoint":return this.auth.loginWithCustomAuthEndpoint({payload:e.payload,encryptionKey:e.encryptionKey});case"iframe_email_verification":return this.auth.loginWithEmailOtp({email:e.email});case"iframe":return this.auth.loginWithModal();case"passkey":{if("sign-up"===e.type){let t=await (0,w.XP)({client:this.wallet.client,ecosystem:this.wallet.ecosystem,authenticatorType:e.authenticatorType,username:e.passkeyName});return this.auth.loginWithAuthToken(t)}let t=await (0,w.OF)({client:this.wallet.client,ecosystem:this.wallet.ecosystem,authenticatorType:e.authenticatorType});return this.auth.loginWithAuthToken(t)}default:W(t)}}async logout(){return await this.auth.logout()}constructor({client:e,onAuthSuccess:t,ecosystem:i}){if(Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"querier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"wallet",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"auth",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.isClientIdLegacyPaper(e.clientId))throw Error("You are using a legacy clientId. Please use the clientId found on the thirdweb dashboard settings page");let n=(0,a.TS)("inAppWallet");this.client=e,this.querier=new d({clientId:e.clientId,ecosystem:i,baseUrl:n}),this.wallet=new O({client:e,ecosystem:i,querier:this.querier}),this.auth=new m({client:e,querier:this.querier,baseUrl:n,ecosystem:i,onAuthSuccess:async e=>(null==t||t(e),await this.wallet.postWalletSetUp({...e.walletDetails,walletUserId:e.storedToken.authDetails.userWalletId}),await this.querier.call({procedureName:"initIframe",params:{partnerId:null==i?void 0:i.partnerId,ecosystemId:null==i?void 0:i.id,deviceShareStored:e.walletDetails.deviceShareStored,clientId:this.client.clientId,walletUserId:e.storedToken.authDetails.userWalletId,authCookie:e.storedToken.cookieString}}),{user:{status:r.Nx.LOGGED_IN_WALLET_INITIALIZED,authDetails:e.storedToken.authDetails,account:await this.wallet.getAccount(),walletAddress:e.walletDetails.walletAddress}})})}}function W(e,t){throw Error(null!=t?t:"Invalid param: ".concat(e))}}}]);