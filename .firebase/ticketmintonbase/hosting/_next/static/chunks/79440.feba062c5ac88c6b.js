"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[79440],{79440:function(e,t,n){n.r(t),n.d(t,{connectSmartWallet:function(){return ey},disconnectSmartWallet:function(){return em},isSmartWallet:function(){return eu},personalAccountToSmartAccountMap:function(){return ed}});var a=n(63121),r=n(85738),i=n(47275),s=n(68725),o=n(90874),c=n(14520);function l(e){if(["string","number"].includes(typeof e)&&!Number.isInteger(Number(e)))throw Error("Expected value to be an integer to convert to a bigint, got ".concat(e," of type ").concat(typeof e));return e instanceof Uint8Array?BigInt((0,c.dg)(e)):BigInt(e)}var u=n(94646),d=n(80695),p=n(73256);let y=e=>{let t=function(e){let{gas:t,nonce:n,to:a,from:r,value:i,maxFeePerGas:s,maxPriorityFeePerGas:o,paymaster:c,paymasterInput:l,gasPerPubdata:u,data:d}=e;return{txType:113n,from:BigInt(r),to:a?BigInt(a):0n,gasLimit:null!=t?t:0n,gasPerPubdataByteLimit:null!=u?u:50000n,maxFeePerGas:null!=s?s:0n,maxPriorityFeePerGas:null!=o?o:0n,paymaster:c?BigInt(c):0n,nonce:n?BigInt(n):0n,value:null!=i?i:0n,data:d||"0x0",factoryDeps:[],paymasterInput:l||"0x"}}(e);return{domain:{name:"zkSync",version:"2",chainId:e.chainId},types:{Transaction:[{name:"txType",type:"uint256"},{name:"from",type:"uint256"},{name:"to",type:"uint256"},{name:"gasLimit",type:"uint256"},{name:"gasPerPubdataByteLimit",type:"uint256"},{name:"maxFeePerGas",type:"uint256"},{name:"maxPriorityFeePerGas",type:"uint256"},{name:"paymaster",type:"uint256"},{name:"nonce",type:"uint256"},{name:"value",type:"uint256"},{name:"data",type:"bytes"},{name:"factoryDeps",type:"bytes32[]"},{name:"paymasterInput",type:"bytes"}]},primaryType:"Transaction",message:t}};async function m(e){let{account:t,eip712Transaction:n,chainId:a}=e,r=y(n),i=await t.signTypedData({...r});return function(e){var t;let{chainId:n,gas:a,nonce:r,to:i,from:o,value:l,maxFeePerGas:u,maxPriorityFeePerGas:d,customSignature:p,factoryDeps:y,paymaster:m,paymasterInput:f,gasPerPubdata:v,data:h}=e,g=[r?(0,c.NC)(r):"0x",d?(0,c.NC)(d):"0x",u?(0,c.NC)(u):"0x",a?(0,c.NC)(a):"0x",null!=i?i:"0x",l?(0,c.NC)(l):"0x",null!=h?h:"0x0",(0,c.NC)(n),(0,c.NC)(""),(0,c.NC)(""),(0,c.NC)(n),null!=o?o:"0x",v?(0,c.NC)(v):(0,c.NC)(50000n),null!=y?y:[],null!=p?p:"0x",m&&f?[m,f]:[]];return t=["0x71",(0,s.LV)(g)],"0x".concat(t.reduce((e,t)=>e+t.replace("0x",""),""))}({...n,chainId:a,customSignature:i})}async function f(e){let{account:t,transaction:n}=e,[a,r,i,s,y,m,f]=await Promise.all([(0,d.encode)(n),(0,u.q)(n.to),(0,u.q)(n.value),(0,u.q)(n.gas),(0,u.q)(n.maxFeePerGas),(0,u.q)(n.maxPriorityFeePerGas),(0,u.q)(n.eip712).then(e=>null==e?void 0:e.gasPerPubdata)]);if(!s||!y||!m){let e=(0,o.getRpcClient)(n),u=await e({method:"zks_estimateFee",params:[{from:t.address,to:r,data:a,value:i?(0,c.eC)(i):void 0}]});s=l(u.gas_limit),y=2n*l(u.max_fee_per_gas),m=l(u.max_priority_fee_per_gas)||1n,f=l(u.gas_per_pubdata_limit)}return{...await (0,p.n)({transaction:{...n,gas:s,maxFeePerGas:y,maxPriorityFeePerGas:m},from:t.address}),...n.eip712,gasPerPubdata:f,from:t.address}}var v=n(24053),h=n(77808),g=n(45581),w=n(95305),b=n(31024);let x=b.r;var A=n(92155),G=n(28201),P=n(67705);let T="/docs/contract/decodeEventLog";var I=n(97009),C=n(80230);class L extends C.G{constructor(e){super('Filter type "'.concat(e,'" is not supported.')),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"FilterTypeNotSupportedError"})}}var M=n(73596),O=n(82112),_=n(8580),E=n(21230),B=n(14433),D=n(9226);let N="/docs/contract/encodeEventTopics";function U(e){let{param:t,value:n}=e;if("string"===t.type||"bytes"===t.type)return(0,O.w)((0,M.O0)(n));if("tuple"===t.type||t.type.match(/^(.*)\[(\d+)?\]$/))throw new L(t.type);return(0,_.E)([t],[n])}var F=n(23565),S=n(49859),j=n(36062),V=n(3556),k=n(1793);let q=()=>{let e=BigInt(Math.floor(4294967296*Math.random())),t=BigInt(Math.floor(4294967296*Math.random())),n=BigInt(Math.floor(4294967296*Math.random())),a=BigInt(Math.floor(4294967296*Math.random())),r=BigInt(Math.floor(4294967296*Math.random())),i=BigInt(Math.floor(4294967296*Math.random()));return e<<BigInt(160)|t<<BigInt(128)|n<<BigInt(96)|a<<BigInt(64)|r<<BigInt(32)|i},H=()=>BigInt((0,V.zo)([(0,c.eC)(q()),"0x0000000000000000"]));function R(e){return Object.fromEntries(Object.entries(e).map(e=>{let[t,n]=e;return[t,(0,k.v)(n)?n:(0,c.NC)(n)]}))}async function z(e){var t,n;return Q({...e,operation:"eth_sendUserOperation",params:[R(e.userOp),null!==(n=null===(t=e.options.overrides)||void 0===t?void 0:t.entrypointAddress)&&void 0!==n?n:j.Ex]})}async function $(e){var t,n;let a=await Q({...e,operation:"eth_estimateUserOperationGas",params:[R(e.userOp),null!==(n=null===(t=e.options.overrides)||void 0===t?void 0:t.entrypointAddress)&&void 0!==n?n:j.Ex]});return{preVerificationGas:(0,c.y_)(a.preVerificationGas),verificationGas:(0,c.y_)(a.verificationGas),verificationGasLimit:(0,c.y_)(a.verificationGasLimit),callGasLimit:(0,c.y_)(a.callGasLimit)+j.X_}}async function W(e){let t=await Q({...e,operation:"thirdweb_getUserOperationGasPrice",params:[]});return{maxPriorityFeePerGas:(0,c.y_)(t.maxPriorityFeePerGas),maxFeePerGas:(0,c.y_)(t.maxFeePerGas)}}async function J(e){let t=await Q({...e,operation:"eth_getUserOperationReceipt",params:[e.userOpHash]});if(t){if(!1===t.success){var n,a;let e=null===(a=function(e){let{logs:t,events:n,strict:a}=e;return function(e){let{abi:t,eventName:n,logs:a,strict:r=!0}=e;return a.map(e=>{try{let a=function(e){let{abi:t,data:n,strict:a,topics:r}=e,i=null==a||a,[s,...o]=r;if(!s)throw new g.FM({docsPath:T});let c=t.find(e=>"event"===e.type&&s===x((0,P.t)(e)));if(!(c&&"name"in c)||"event"!==c.type)throw new g.lC(s,{docsPath:T});let{name:l,inputs:u}=c,d=null==u?void 0:u.some(e=>!("name"in e&&e.name)),p=d?[]:{},y=u.filter(e=>"indexed"in e&&e.indexed);for(let e=0;e<y.length;e++){let t=y[e],n=o[e];if(!n)throw new g.Gy({abiItem:c,param:t});p[d?e:t.name||e]=function(e){let{param:t,value:n}=e;return"string"===t.type||"bytes"===t.type||"tuple"===t.type||t.type.match(/^(.*)\[(\d+)?\]$/)?n:((0,G.r)([t],n)||[])[0]}({param:t,value:n})}let m=u.filter(e=>!("indexed"in e&&e.indexed));if(m.length>0){if(n&&"0x"!==n)try{let e=(0,G.r)(m,n);if(e){if(d)p=[...p,...e];else for(let t=0;t<m.length;t++)p[m[t].name]=e[t]}}catch(e){if(i){if(e instanceof g.xB||e instanceof A.lQ)throw new g.SM({abiItem:c,data:n,params:m,size:(0,w.d)(n)});throw e}}else if(i)throw new g.SM({abiItem:c,data:"0x",params:m,size:0})}return{eventName:l,args:Object.values(p).length>0?p:void 0}}({...e,abi:t,strict:r});if(n&&!n.includes(a.eventName))return null;return{...a,...e}}catch(i){let t,n;if(i instanceof g.lC)return null;if(i instanceof g.SM||i instanceof g.Gy){var a;if(r)return null;t=i.abiItem.name,n=null===(a=i.abiItem.inputs)||void 0===a?void 0:a.some(e=>!("name"in e&&e.name))}return{...e,args:n?[]:{},eventName:t}}}).filter(Boolean)}({logs:t,abi:n.map(e=>e.abiEvent),strict:a})}({events:[function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e){let t;let{signature:n}=e;return{abiEvent:t=n&&"object"==typeof n&&"type"in n&&"event"===n.type?n:(0,I.s)(n),hash:(0,b.r)(t),topics:function(e){let{abi:t,eventName:n,args:a}=e,r=t[0];if(n){let e=function(e){let t;let{abi:n,args:a=[],name:r}=e,i=(0,E.v)(r,{strict:!1}),s=n.filter(e=>i?"function"===e.type?(0,D.C)(e)===r:"event"===e.type&&x(e)===r:"name"in e&&e.name===r);if(0!==s.length){if(1===s.length)return s[0];for(let e of s)if("inputs"in e){if(!a||0===a.length){if(!e.inputs||0===e.inputs.length)return e;continue}if(e.inputs&&0!==e.inputs.length&&e.inputs.length===a.length&&a.every((t,n)=>{let a="inputs"in e&&e.inputs[n];return!!a&&function e(t,n){let a=typeof t,r=n.type;switch(r){case"address":return(0,B.U)(t,{strict:!1});case"bool":return"boolean"===a;case"function":case"string":return"string"===a;default:if("tuple"===r&&"components"in n)return Object.values(n.components).every((n,a)=>e(Object.values(t)[a],n));if(/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(r))return"number"===a||"bigint"===a;if(/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(r))return"string"===a||t instanceof Uint8Array;if(/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(r))return Array.isArray(t)&&t.every(t=>e(t,{...n,type:r.replace(/(\[[0-9]{0,}\])$/,"")}));return!1}}(t,a)})){if(t&&"inputs"in t&&t.inputs){let n=function e(t,n,a){for(let r in t){let i=t[r],s=n[r];if("tuple"===i.type&&"tuple"===s.type&&"components"in i&&"components"in s)return e(i.components,s.components,a[r]);let o=[i.type,s.type];if(o.includes("address")&&o.includes("bytes20")||(o.includes("address")&&o.includes("string")||o.includes("address")&&o.includes("bytes"))&&(0,B.U)(a[r],{strict:!1}))return o}}(e.inputs,t.inputs,a);if(n)throw new g.S4({abiItem:e,type:n[0]},{abiItem:t,type:n[1]})}t=e}}return t||s[0]}}({abi:t,name:n});if(!e)throw new g.mv(n,{docsPath:N});r=e}if("event"!==r.type)throw new g.mv(void 0,{docsPath:N});let i=x((0,P.t)(r)),s=[];if(a&&"inputs"in r){var o,c,l;let e=null===(o=r.inputs)||void 0===o?void 0:o.filter(e=>"indexed"in e&&e.indexed),t=Array.isArray(a)?a:Object.values(a).length>0&&null!==(c=null==e?void 0:e.map(e=>a[e.name]))&&void 0!==c?c:[];t.length>0&&(s=null!==(l=null==e?void 0:e.map((e,n)=>Array.isArray(t[n])?t[n].map((a,r)=>U({param:e,value:t[n][r]})):t[n]?U({param:e,value:t[n]}):null))&&void 0!==l?l:[])}return[i,...s]}({abi:[t],args:e.filters})}}({signature:"event UserOperationRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)",filters:e})}()],logs:t.logs})[0])||void 0===a?void 0:null===(n=a.args)||void 0===n?void 0:n.revertReason;if(!e)throw Error("UserOp failed at txHash: ".concat(t.transactionHash));let r=(0,h.p)({data:e});throw Error("UserOp failed with reason: '".concat(r.args.join(","),"' at txHash: ").concat(t.transactionHash))}return t.receipt}}async function X(e){let t=await Q({options:e.options,operation:"zk_paymasterData",params:[e.transaction]});return{paymaster:t.paymaster,paymasterInput:t.paymasterInput}}async function K(e){return{transactionHash:(await Q({options:e.options,operation:"zk_broadcastTransaction",params:[{...e.transaction,signedTransaction:e.signedTransaction}]})).transactionHash}}async function Q(e){var t,n;let{options:a,operation:r,params:i}=e;j.eM&&console.debug(">>> sending ".concat(r," with payload:"),i);let s=null!==(n=null===(t=a.overrides)||void 0===t?void 0:t.bundlerUrl)&&void 0!==n?n:(0,j.Rg)(a.chain),o=(0,F.NX)(a.client),c=await o(s,{method:"POST",headers:{"Content-Type":"application/json"},body:(0,S.P)({jsonrpc:"2.0",id:1,method:r,params:i})}),l=await c.json();if(!c.ok||l.error){let e=l.error||c.statusText;"object"==typeof e&&(e=JSON.stringify(e));let t=l.code||"UNKNOWN";throw Error("".concat(r," error: ").concat(e,"\nStatus: ").concat(c.status,"\nCode: ").concat(t))}return j.eM&&console.debug("<<< ".concat(r," result:"),l),l.result}var Y=n(14698),Z=n(94293);async function ee(e,t){var n,a,r,i;if(null===(n=t.overrides)||void 0===n?void 0:n.predictAddress)return t.overrides.predictAddress(e);if(null===(a=t.overrides)||void 0===a?void 0:a.accountAddress)return t.overrides.accountAddress;let s=t.personalAccountAddress;if(!s)throw Error("Account address is required to predict the smart wallet address.");let o=(0,c.$G)(null!==(i=null===(r=t.overrides)||void 0===r?void 0:r.accountSalt)&&void 0!==i?i:"");return(0,Z.readContract)({contract:e,method:"function getAddress(address, bytes) returns (address)",params:[s,o]})}var et=n(75525),en=n(97686),ea=n(88267),er=n(47456),ei=n(81990);async function es(e){var t,n,a,r,i;let{userOp:s,options:o}=e;if(null===(t=o.overrides)||void 0===t?void 0:t.paymaster)return null===(r=o.overrides)||void 0===r?void 0:r.paymaster(s);let l=o.client,u=(0,j.K9)(o.chain),d=null!==(i=null===(n=o.overrides)||void 0===n?void 0:n.entrypointAddress)&&void 0!==i?i:j.Ex,p=(0,F.NX)(l),y=await p(u,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:1,method:"pm_sponsorUserOperation",params:[R(s),d]})}),m=await y.json();if(!y.ok){let e=m.error||y.statusText,t=m.code||"UNKNOWN";throw Error("Paymaster error: ".concat(e,"\nStatus: ").concat(y.status,"\nCode: ").concat(t))}if(j.eM&&console.debug("Paymaster result:",m),m.result)return"string"==typeof m.result?{paymasterAndData:m.result}:{paymasterAndData:m.result.paymasterAndData,verificationGasLimit:m.result.verificationGasLimit?(0,c.y_)(m.result.verificationGasLimit):void 0,preVerificationGas:m.result.preVerificationGas?(0,c.y_)(m.result.preVerificationGas):void 0,callGasLimit:m.result.callGasLimit?(0,c.y_)(m.result.callGasLimit):void 0};let f=(null===(a=m.error)||void 0===a?void 0:a.message)||m.error||y.statusText||"unknown error";throw Error("Paymaster error from ".concat(u,": ").concat(f))}async function eo(e){var t,n,a,r;let{executeTx:i,options:s}=e,o=await (0,ea.isContractDeployed)(s.accountContract)?"0x":await el(s),c=await (0,d.encode)(i),{maxFeePerGas:l,maxPriorityFeePerGas:p}=i,y=null!==(n=null===(t=s.overrides)||void 0===t?void 0:t.bundlerUrl)&&void 0!==n?n:(0,j.Rg)(s.chain);if((0,F.Rm)(y)){let e=await W({options:s});l=e.maxFeePerGas,p=e.maxPriorityFeePerGas}else{let[e,t]=await Promise.all([(0,u.q)(l),(0,u.q)(p)]);if(e&&t)l=e,p=t;else{let n=await (0,et.E)(s.client,s.chain);p=null!==(a=null!=t?t:n.maxPriorityFeePerGas)&&void 0!==a?a:0n,l=null!==(r=null!=e?e:n.maxFeePerGas)&&void 0!==r?r:0n}}let m=H(),f={sender:s.accountContract.address,nonce:m,initCode:o,callData:c,maxFeePerGas:l,maxPriorityFeePerGas:p,callGasLimit:0n,verificationGasLimit:0n,preVerificationGas:0n,paymasterAndData:"0x",signature:j.Ld};if(s.sponsorGas){let e=await es({userOp:f,options:s}),t=e.paymasterAndData;if(t&&"0x"!==t&&(f.paymasterAndData=t),e.callGasLimit&&e.verificationGasLimit&&e.preVerificationGas)f.callGasLimit=e.callGasLimit,f.verificationGasLimit=e.verificationGasLimit,f.preVerificationGas=e.preVerificationGas;else{let e=await $({userOp:f,options:s});if(f.callGasLimit=e.callGasLimit,f.verificationGasLimit=e.verificationGasLimit,f.preVerificationGas=e.preVerificationGas,t&&"0x"!==t){let e=await es({userOp:f,options:s});e.paymasterAndData&&"0x"!==e.paymasterAndData&&(f.paymasterAndData=e.paymasterAndData)}}}else{let e=await $({userOp:f,options:s});f.callGasLimit=e.callGasLimit,f.verificationGasLimit=e.verificationGasLimit,f.preVerificationGas=e.preVerificationGas}return{...f,signature:"0x"}}async function ec(e){var t;let{userOp:n,options:a}=e,r=function(e){let{userOp:t,entryPoint:n,chainId:a}=e,r=(0,ei.w)(t.initCode),i=(0,ei.w)(t.callData),s=(0,ei.w)(t.paymasterAndData),o=(0,en.encodeAbiParameters)([{type:"address"},{type:"uint256"},{type:"bytes32"},{type:"bytes32"},{type:"uint256"},{type:"uint256"},{type:"uint256"},{type:"uint256"},{type:"uint256"},{type:"bytes32"}],[t.sender,t.nonce,r,i,t.callGasLimit,t.verificationGasLimit,t.preVerificationGas,t.maxFeePerGas,t.maxPriorityFeePerGas,s]),c=(0,en.encodeAbiParameters)([{type:"bytes32"},{type:"address"},{type:"uint256"}],[(0,ei.w)(o),n,BigInt(a)]);return(0,ei.w)(c)}({userOp:n,entryPoint:(null===(t=a.overrides)||void 0===t?void 0:t.entrypointAddress)||j.Ex,chainId:a.chain.id});if(a.personalAccount.signMessage){let e=await a.personalAccount.signMessage({message:{raw:(0,er.nr)(r)}});return{...n,signature:e}}throw Error("signMessage not implemented in signingAccount")}async function el(e){let{factoryContract:t}=e,n=function(e){var t,n,a;let{factoryContract:r,options:i}=e;return(null===(t=i.overrides)||void 0===t?void 0:t.createAccount)?i.overrides.createAccount(r):(0,Y.A)({contract:r,method:"function createAccount(address, bytes) returns (address)",params:[i.personalAccount.address,(0,c.$G)(null!==(a=null===(n=i.overrides)||void 0===n?void 0:n.accountSalt)&&void 0!==a?a:"")]})}({factoryContract:t,options:e});return(0,V.zo)([t.address,await (0,d.encode)(n)])}function eu(e){return"smart"===e.id}let ed=new WeakMap,ep=new WeakMap;async function ey(e,t,n){var a;let{personalAccount:s,client:o,chain:c}=t;if(!s)throw Error("Personal wallet does not have an account");let l=null!==(a=n.factoryAddress)&&void 0!==a?a:j.mV,u=null!=c?c:n.chain,d="gasless"in n?n.gasless:n.sponsorGas;if(324===u.id||300===u.id||302===u.id)return[function(e){let{creationOptions:t,connectionOptions:n,chain:a}=e,i={address:n.personalAccount.address,async sendTransaction(s){var o,c;let l={data:s.data,to:null!==(o=s.to)&&void 0!==o?o:void 0,value:null!==(c=s.value)&&void 0!==c?c:0n,chain:(0,r.XY)(s.chainId),client:n.client},u=await f({account:i,transaction:l});if(e.sponsorGas){let e=await X({options:{client:n.client,overrides:t.overrides,chain:a},transaction:u});u={...u,...e}}let d=await m({account:i,chainId:a.id,eip712Transaction:u});return{transactionHash:(await K({options:{client:n.client,overrides:t.overrides,chain:a},transaction:u,signedTransaction:d})).transactionHash,client:n.client,chain:a}},async signMessage(e){let{message:t}=e;return n.personalAccount.signMessage({message:t})},async signTypedData(e){let t=(0,v.t)(e);return n.personalAccount.signTypedData(t)},async onTransactionRequested(e){var t,a;return null===(t=(a=n.personalAccount).onTransactionRequested)||void 0===t?void 0:t.call(a,e)}};return i}({creationOptions:n,connectionOptions:t,chain:u,sponsorGas:d}),u];let p=(0,i.getContract)({client:o,address:l,chain:u}),y=await ee(p,{personalAccountAddress:s.address,...n}).then(e=>e).catch(e=>{throw Error("Failed to get account address with factory contract ".concat(p.address," on chain ID ").concat(u.id,". Are you on the right chain?"),{cause:e})}),h=(0,i.getContract)({client:o,address:y,chain:u}),g=await ef({...n,chain:u,sponsorGas:d,personalAccount:s,accountContract:h,factoryContract:p,client:o});return ed.set(s,e),ep.set(e,s),[g,u]}async function em(e){let t=ep.get(e);t&&(ed.delete(t),ep.delete(e))}async function ef(e){let{accountContract:t}=e,r={address:t.address,sendTransaction:async n=>eh({executeTx:function(e){var t;let{accountContract:n,options:a,transaction:r}=e;return(null===(t=a.overrides)||void 0===t?void 0:t.execute)?a.overrides.execute(n,r):(0,Y.A)({contract:n,method:"function execute(address, uint256, bytes)",params:[r.to||"",r.value||0n,r.data||"0x"]})}({accountContract:t,options:e,transaction:n}),options:e}),sendBatchTransaction:async n=>eh({executeTx:function(e){var t;let{accountContract:n,options:a,transactions:r}=e;return(null===(t=a.overrides)||void 0===t?void 0:t.executeBatch)?a.overrides.executeBatch(n,r):(0,Y.A)({contract:n,method:"function executeBatch(address[], uint256[], bytes[])",params:[r.map(e=>e.to||""),r.map(e=>e.value||0n),r.map(e=>e.data||"0x")]})}({accountContract:t,options:e,transactions:n}),options:e}),async signMessage(a){let i,{message:s}=a,[{isContractDeployed:o},{readContract:c},{encodeAbiParameters:l},{hashMessage:u},{checkContractWalletSignature:d}]=await Promise.all([Promise.resolve().then(n.bind(n,88267)),Promise.resolve().then(n.bind(n,94293)),Promise.resolve().then(n.bind(n,97686)),n.e(49045).then(n.bind(n,49045)),n.e(45941).then(n.bind(n,45941))]);await o(t)||(console.log("Account contract not deployed yet. Deploying account before signing message"),await ev({options:e,account:r,accountContract:t}));let p=u(s),y=!1;try{await c({contract:t,method:"function getMessageHash(bytes32 _hash) public view returns (bytes32)",params:[p]}),y=!0}catch(e){}if(y){let n=l([{type:"bytes32"}],[p]);i=await e.personalAccount.signTypedData({domain:{name:"Account",version:"1",chainId:e.chain.id,verifyingContract:t.address},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]},message:{message:n}})}else i=await e.personalAccount.signMessage({message:s});if(await d({contract:t,message:s,signature:i}))return i;throw Error("Unable to verify signature on smart account, please make sure the smart account is deployed and the signature is valid.")},async signTypedData(i){var s,o,c;let l;let u=(0,v.t)(i),[{isContractDeployed:d},{readContract:p},{encodeAbiParameters:y},{checkContractWalletSignedTypedData:m}]=await Promise.all([Promise.resolve().then(n.bind(n,88267)),Promise.resolve().then(n.bind(n,94293)),Promise.resolve().then(n.bind(n,97686)),n.e(91348).then(n.bind(n,91348))]);if((null===(o=u.domain)||void 0===o?void 0:null===(s=o.verifyingContract)||void 0===s?void 0:s.toLowerCase())===(null===(c=t.address)||void 0===c?void 0:c.toLowerCase()))return e.personalAccount.signTypedData(u);await d(t)||(console.log("Account contract not deployed yet. Deploying account before signing message"),await ev({options:e,account:r,accountContract:t}));let f=(0,a.Jv)(u),h=!1;try{await p({contract:t,method:"function getMessageHash(bytes32 _hash) public view returns (bytes32)",params:[f]}),h=!0}catch(e){}if(h){let n=y([{type:"bytes32"}],[f]);l=await e.personalAccount.signTypedData({domain:{name:"Account",version:"1",chainId:e.chain.id,verifyingContract:t.address},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]},message:{message:n}})}else l=await e.personalAccount.signTypedData(u);if(await m({contract:t,data:u,signature:l}))return l;throw Error("Unable to verify signature on smart account, please make sure the smart account is deployed and the signature is valid.")},async onTransactionRequested(t){var n,a;return null===(n=(a=e.personalAccount).onTransactionRequested)||void 0===n?void 0:n.call(a,t)}};return r}async function ev(e){let{options:t,account:a,accountContract:r}=e,[{sendTransaction:i},{prepareTransaction:s}]=await Promise.all([Promise.resolve().then(n.bind(n,71551)),Promise.resolve().then(n.bind(n,26554))]),o=s({client:t.client,chain:t.chain,to:r.address,value:0n,gas:50000n});return await i({transaction:o,account:a})}async function eh(e){let{executeTx:t,options:n}=e,a=await eo({executeTx:t,options:n}),r=await ec({options:n,userOp:a}),i=await z({options:n,userOp:r}),s=await eg({options:n,userOpHash:i});return{client:n.client,chain:n.chain,transactionHash:s.transactionHash}}async function eg(e){let{options:t,userOpHash:n}=e,a=Date.now()+12e4;for(;Date.now()<a;){let e=await J({options:t,userOpHash:n});if(e)return e;await new Promise(e=>setTimeout(e,1e3))}throw Error("Timeout waiting for userOp to be mined")}},68725:function(e,t,n){n.d(t,{LV:function(){return o}});var a=n(80230),r=n(3425),i=n(73596),s=n(15578);function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"hex",n=function e(t){return Array.isArray(t)?function(e){let t=e.reduce((e,t)=>e+t.length,0),n=c(t);return{length:t<=55?1+t:1+n+t,encode(a){for(let{encode:r}of(t<=55?a.pushByte(192+t):(a.pushByte(247+n),1===n?a.pushUint8(t):2===n?a.pushUint16(t):3===n?a.pushUint24(t):a.pushUint32(t)),e))r(a)}}}(t.map(t=>e(t))):function(e){let t="string"==typeof e?(0,i.nr)(e):e,n=c(t.length);return{length:1===t.length&&t[0]<128?1:t.length<=55?1+t.length:1+n+t.length,encode(e){1===t.length&&t[0]<128||(t.length<=55?e.pushByte(128+t.length):(e.pushByte(183+n),1===n?e.pushUint8(t.length):2===n?e.pushUint16(t.length):3===n?e.pushUint24(t.length):e.pushUint32(t.length))),e.pushBytes(t)}}}(t)}(e),a=(0,r.q)(new Uint8Array(n.length));return(n.encode(a),"hex"===t)?(0,s.ci)(a.bytes):a.bytes}function c(e){if(e<256)return 1;if(e<65536)return 2;if(e<16777216)return 3;if(e<4294967296)return 4;throw new a.G("Length is too large.")}},63121:function(e,t,n){n.d(t,{Jv:function(){return c}});var a=n(8580),r=n(3556),i=n(15578),s=n(82112),o=n(89995);function c(e){let{domain:t={},message:n,primaryType:a}=e,i={EIP712Domain:(0,o.cj)({domain:t}),...e.types};(0,o.iC)({domain:t,message:n,primaryType:a,types:i});let c=["0x1901"];return t&&c.push(function(e){let{domain:t,types:n}=e;return l({data:t,primaryType:"EIP712Domain",types:n})}({domain:t,types:i})),"EIP712Domain"!==a&&c.push(l({data:n,primaryType:a,types:i})),(0,s.w)((0,r.zo)(c))}function l(e){let{data:t,primaryType:n,types:r}=e,o=function e(t){let{data:n,primaryType:r,types:o}=t,c=[{type:"bytes32"}],l=[function(e){let{primaryType:t,types:n}=e,a=(0,i.NC)(function(e){let{primaryType:t,types:n}=e,a="",r=function e(t){let{primaryType:n,types:a}=t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set,i=n.match(/^\w*/u),s=null==i?void 0:i[0];if(r.has(s)||void 0===a[s])return r;for(let t of(r.add(s),a[s]))e({primaryType:t.type,types:a},r);return r}({primaryType:t,types:n});for(let e of(r.delete(t),[t,...Array.from(r).sort()]))a+="".concat(e,"(").concat(n[e].map(e=>{let{name:t,type:n}=e;return"".concat(n," ").concat(t)}).join(","),")");return a}({primaryType:t,types:n}));return(0,s.w)(a)}({primaryType:r,types:o})];for(let t of o[r]){let[r,u]=function t(n){let{types:r,name:o,type:c,value:l}=n;if(void 0!==r[c])return[{type:"bytes32"},(0,s.w)(e({data:l,primaryType:c,types:r}))];if("bytes"===c){let e=l.length%2?"0":"";return l="0x".concat(e+l.slice(2)),[{type:"bytes32"},(0,s.w)(l)]}if("string"===c)return[{type:"bytes32"},(0,s.w)((0,i.NC)(l))];if(c.lastIndexOf("]")===c.length-1){let e=c.slice(0,c.lastIndexOf("[")),n=l.map(n=>t({name:o,type:e,types:r,value:n}));return[{type:"bytes32"},(0,s.w)((0,a.E)(n.map(e=>{let[t]=e;return t}),n.map(e=>{let[,t]=e;return t})))]}return[{type:c},l]}({types:o,name:t.name,type:t.type,value:n[t.name]});c.push(r),l.push(u)}return(0,a.E)(c,l)}({data:t,primaryType:n,types:r});return(0,s.w)(o)}}}]);